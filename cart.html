<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>购物车 - GameTopUp</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --primary-color: #6C63FF;
      --secondary-color: #FF6584;
      --light-color: #F8F9FA;
      --text-dark: #333;
      --text-light: #666;
      --text-muted: #999;
      --shadow-sm: 0 2px 4px rgba(0,0,0,0.1);
      --radius-md: 12px;
      --radius-lg: 16px;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background-color: var(--light-color);
      color: var(--text-dark);
      padding-bottom: 80px;
    }
    .container { max-width: 1200px; margin: 0 auto; padding: 0 15px; }
    .header {
      background: white;
      padding: 15px 0;
      position: sticky;
      top: 0;
      z-index: 1000;
      box-shadow: var(--shadow-sm);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .header-title { font-size: 1.2rem; font-weight: 700; }
    .back-btn {
      background: none; border: none; font-size: 1rem;
      color: var(--text-dark); cursor: pointer; padding: 5px 10px;
    }
    .clear-btn {
      color: var(--secondary-color); font-size: 0.9rem;
      background: none; border: none; cursor: pointer;
    }
    .cart-list { padding: 15px 0; }
    .cart-item {
      background: white;
      border-radius: var(--radius-md);
      padding: 15px;
      margin-bottom: 12px;
      box-shadow: var(--shadow-sm);
      display: flex;
      gap: 15px;
    }
    .item-image {
      width: 80px; height: 80px;
      border-radius: var(--radius-md);
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex; align-items: center; justify-content: center;
      color: white; font-size: 1.5rem; flex-shrink: 0;
    }
    .item-details { flex: 1; display: flex; flex-direction: column; justify-content: space-between; }
    .item-name { font-weight: 600; margin-bottom: 5px; }
    .item-package { font-size: 0.85rem; color: var(--text-light); margin-bottom: 5px; }
    .item-price { color: var(--primary-color); font-weight: 700; }
    .quantity-control {
      display: flex; align-items: center; gap: 10px; margin-top: 8px;
    }
    .qty-btn {
      width: 28px; height: 28px; border-radius: 50%;
      border: 1px solid #ddd; background: white;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer; font-size: 1rem;
    }
    .qty-value { font-weight: 600; min-width: 20px; text-align: center; }
    .delete-btn {
      color: var(--text-muted); cursor: pointer;
      padding: 5px; align-self: flex-start;
    }
    .delete-btn:hover { color: var(--secondary-color); }
    .empty-cart {
      text-align: center; padding: 60px 20px; color: var(--text-light);
    }
    .empty-cart i { font-size: 4rem; margin-bottom: 20px; opacity: 0.3; }
    .empty-cart button {
      margin-top: 20px; padding: 10px 30px;
      background: var(--primary-color); color: white;
      border: none; border-radius: 20px;
      font-weight: 600; cursor: pointer;
    }
    .checkout-bar {
      position: fixed; bottom: 0; left: 0; right: 0;
      background: white; padding: 15px 20px;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
      display: flex; justify-content: space-between; align-items: center;
      z-index: 1000;
    }
    .total-info { display: flex; flex-direction: column; }
    .total-label { font-size: 0.8rem; color: var(--text-light); }
    .total-amount { font-size: 1.4rem; font-weight: 700; color: var(--primary-color); }
    .checkout-btn {
      background: linear-gradient(135deg, var(--primary-color), #36D1DC);
      color: white; border: none; padding: 12px 30px;
      border-radius: 25px; font-weight: 600; font-size: 1rem;
      cursor: pointer; box-shadow: 0 4px 15px rgba(108, 99, 255, 0.3);
    }
    .checkout-btn:disabled {
      background: #ccc; cursor: not-allowed; box-shadow: none;
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="container" style="display: flex; justify-content: space-between; width: 100%; align-items: center;">
      <button class="back-btn" id="backBtn"><i class="fas fa-arrow-left"></i> 返回</button>
      <div class="header-title">购物车 (<span id="cartCount">0</span>)</div>
      <button class="clear-btn" id="clearBtn">清空</button>
    </div>
  </header>
  <div class="container">
    <div class="cart-list" id="cartList"></div>
    <div class="empty-cart" id="emptyCart" style="display: none;">
      <i class="fas fa-shopping-cart"></i>
      <h3>购物车是空的</h3>
      <p>快去挑选喜欢的游戏充值吧～</p>
      <button onclick="window.location.href='index.html'">去逛逛</button>
    </div>
  </div>
  <div class="checkout-bar" id="checkoutBar" style="display: none;">
    <div class="total-info">
      <span class="total-label">应付总额</span>
      <span class="total-amount" id="totalAmount">¥0.00</span>
    </div>
    <button class="checkout-btn" id="checkoutBtn">去结算</button>
  </div>
  <script>
    function safeGetStorage(key, defaultValue) {
      try {
        const item = localStorage.getItem(key);
        return item ? JSON.parse(item) : defaultValue;
      } catch (e) { return defaultValue; }
    }
    function safeSetStorage(key, value) {
      try {
        localStorage.setItem(key, JSON.stringify(value));
        return true;
      } catch (e) { return false; }
    }
    let cart = [];
    function initCart() {
      cart = safeGetStorage('gameTopUpCart', []);
      renderCart();
      updateCartCount();
    }
    function renderCart() {
      const cartList = document.getElementById('cartList');
      const emptyCart = document.getElementById('emptyCart');
      const checkoutBar = document.getElementById('checkoutBar');
      cartList.innerHTML = '';
      if (cart.length === 0) {
        emptyCart.style.display = 'block';
        checkoutBar.style.display = 'none';
        return;
      }
      emptyCart.style.display = 'none';
      checkoutBar.style.display = 'flex';
      let total = 0;
      cart.forEach((item, index) => {
        const itemTotal = item.package.price * item.quantity;
        total += itemTotal;
        const div = document.createElement('div');
        div.className = 'cart-item';
        div.innerHTML = `
          <div class="item-image"><i class="fas fa-gamepad"></i></div>
          <div class="item-details">
            <div>
              <div class="item-name">${item.game}</div>
              <div class="item-package">${item.package.name}</div>
              <div class="item-price">¥${item.package.price.toFixed(2)}</div>
            </div>
            <div class="quantity-control">
              <button class="qty-btn" onclick="updateQuantity(${index}, -1)">-</button>
              <span class="qty-value">${item.quantity}</span>
              <button class="qty-btn" onclick="updateQuantity(${index}, 1)">+</button>
            </div>
          </div>
          <div class="delete-btn" onclick="removeItem(${index})"><i class="fas fa-trash"></i></div>
        `;
        cartList.appendChild(div);
      });
      document.getElementById('totalAmount').textContent = `¥${total.toFixed(2)}`;
    }
    window.updateQuantity = function(index, change) {
      if (cart[index].quantity + change < 1) return;
      cart[index].quantity += change;
      safeSetStorage('gameTopUpCart', cart);
      renderCart();
      updateCartCount();
    };
    window.removeItem = function(index) {
      if (confirm('确定要删除这个商品吗？')) {
        cart.splice(index, 1);
        safeSetStorage('gameTopUpCart', cart);
        renderCart();
        updateCartCount();
      }
    };
    document.getElementById('clearBtn').addEventListener('click', () => {
      if (cart.length === 0) return;
      if (confirm('确定要清空购物车吗？')) {
        cart = [];
        safeSetStorage('gameTopUpCart', cart);
        renderCart();
        updateCartCount();
      }
    });
    function updateCartCount() {
      const count = cart.reduce((sum, item) => sum + item.quantity, 0);
      document.getElementById('cartCount').textContent = count;
    }
    document.getElementById('backBtn').addEventListener('click', () => {
      window.location.href = 'index.html';
    });
    document.getElementById('checkoutBtn').addEventListener('click', () => {
      if (cart.length === 0) return;
      const orderData = {
        items: cart,
        total: cart.reduce((sum, item) => sum + item.package.price * item.quantity, 0),
        date: new Date().toISOString(),
        orderId: 'ORD' + Date.now()
      };
      sessionStorage.setItem('pendingOrder', JSON.stringify(orderData));
      window.location.href = 'payment.html';
    });
    document.addEventListener('DOMContentLoaded', initCart);
  </script>
</body>
</html>