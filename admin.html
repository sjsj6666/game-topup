<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GameTopUp ç®¡ç†åå°</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="config.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --primary: #6C63FF;
      --secondary: #FF6584;
      --success: #28A745;
      --warning: #FFC107;
      --danger: #DC3545;
      --dark: #1A1A2E;
      --light: #F8F9FA;
      --sidebar-width: 250px;
    }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--light); }
    
    /* ç™»å½•é¡µé¢ */
    .login-container { min-height: 100vh; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, var(--primary), var(--secondary)); }
    .login-box { background: white; padding: 40px; border-radius: 16px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); width: 100%; max-width: 400px; }
    .login-title { text-align: center; font-size: 1.8rem; margin-bottom: 30px; color: var(--primary); }
    .form-group { margin-bottom: 20px; }
    .form-label { display: block; margin-bottom: 8px; font-weight: 500; }
    .form-input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; }
    .btn { padding: 12px 24px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s; }
    .btn-primary { background: var(--primary); color: white; width: 100%; }
    .btn-primary:hover { background: #5a52d5; transform: translateY(-2px); }
    
    /* ç®¡ç†é¢æ¿å¸ƒå±€ */
    .admin-layout { display: flex; min-height: 100vh; }
    
    /* ä¾§è¾¹æ  */
    .sidebar {
      width: var(--sidebar-width);
      background: white;
      box-shadow: 2px 0 10px rgba(0,0,0,0.1);
      position: fixed;
      height: 100vh;
      overflow-y: auto;
      z-index: 1000;
    }
    .sidebar-header {
      padding: 20px;
      background: var(--primary);
      color: white;
      text-align: center;
    }
    .sidebar-header h2 { font-size: 1.5rem; margin-bottom: 5px; }
    .sidebar-menu { padding: 20px 0; }
    .menu-item {
      padding: 15px 20px;
      display: flex;
      align-items: center;
      gap: 15px;
      cursor: pointer;
      transition: all 0.3s;
      border-left: 3px solid transparent;
    }
    .menu-item:hover { background: #f0f0f0; }
    .menu-item.active {
      background: rgba(108, 99, 255, 0.1);
      border-left-color: var(--primary);
      color: var(--primary);
    }
    .menu-item i { font-size: 1.2rem; width: 24px; }
    
    /* ä¸»å†…å®¹åŒº */
    .main-content {
      flex: 1;
      margin-left: var(--sidebar-width);
      padding: 30px;
    }
    .top-bar {
      background: white;
      padding: 20px 30px;
      border-radius: 12px;
      margin-bottom: 30px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .user-info { display: flex; align-items: center; gap: 15px; }
    .logout-btn { background: var(--danger); color: white; padding: 8px 20px; border-radius: 8px; cursor: pointer; }
    
    /* ç»Ÿè®¡å¡ç‰‡ */
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
    .stat-card {
      background: white;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      display: flex;
      align-items: center;
      gap: 20px;
    }
    .stat-icon {
      width: 60px;
      height: 60px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      color: white;
    }
    .stat-icon.games { background: var(--primary); }
    .stat-icon.orders { background: var(--success); }
    .stat-icon.seo { background: var(--warning); color: #333; }
    .stat-icon.users { background: var(--secondary); }
    .stat-info h3 { font-size: 2rem; color: var(--dark); margin-bottom: 5px; }
    .stat-info p { color: #666; font-size: 0.9rem; }
    
    /* å†…å®¹åŒºåŸŸ */
    .content-section {
      background: white;
      border-radius: 12px;
      padding: 25px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid #eee;
    }
    .section-title { font-size: 1.3rem; font-weight: 700; }
    .search-box {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }
    .search-input {
      flex: 1;
      padding: 10px 15px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 1rem;
    }
    
    /* è¡¨æ ¼ */
    .data-table { width: 100%; border-collapse: collapse; }
    .data-table th, .data-table td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; }
    .data-table th { background: #f8f9fa; font-weight: 600; }
    .data-table tr:hover { background: #f8f9fa; }
    
    /* åˆ†é¡µ */
    .pagination {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid #eee;
    }
    .pagination-info { color: #666; }
    .pagination-buttons { display: flex; gap: 5px; }
    .page-btn {
      padding: 8px 15px;
      border: 1px solid #ddd;
      background: white;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s;
    }
    .page-btn:hover { background: #f0f0f0; }
    .page-btn.active { background: var(--primary); color: white; border-color: var(--primary); }
    .page-btn:disabled { opacity: 0.5; cursor: not-allowed; }
    
    /* æ ‡ç­¾ */
    .badge { padding: 4px 12px; border-radius: 12px; font-size: 0.8rem; font-weight: 600; }
    .badge-success { background: #d4edda; color: #155724; }
    .badge-warning { background: #fff3cd; color: #856404; }
    .badge-danger { background: #f8d7da; color: #721c24; }
    
    /* æŒ‰é’®ç»„ */
    .btn-group { display: flex; gap: 5px; }
    .btn-sm { padding: 6px 12px; font-size: 0.85rem; }
    .btn-edit { background: var(--warning); color: #333; }
    .btn-delete { background: var(--danger); color: white; }
    .btn-add { background: var(--success); color: white; }
    
    /* å“åº”å¼ */
    @media (max-width: 768px) {
      .sidebar { width: 70px; }
      .sidebar-header h2, .menu-text { display: none; }
      .main-content { margin-left: 70px; padding: 15px; }
      .stats-grid { grid-template-columns: 1fr; }
    }
    
    /* éšè—/æ˜¾ç¤º */
    .tab-content { display: none; }
    .tab-content.active { display: block; }
  </style>
</head>
<body>
  <!-- ç™»å½•é¡µé¢ -->
  <div class="login-container" id="loginContainer">
    <div class="login-box">
      <h1 class="login-title">ğŸ® GameTopUp ç®¡ç†åå°</h1>
      <div class="form-group">
        <label class="form-label">é‚®ç®±</label>
        <input type="email" class="form-input" id="email" placeholder="admin@gametopup.com">
      </div>
      <div class="form-group">
        <label class="form-label">å¯†ç </label>
        <input type="password" class="form-input" id="password" placeholder="å¯†ç ">
      </div>
      <button class="btn btn-primary" onclick="login()">ç™»å½•</button>
      <p style="text-align: center; margin-top: 15px; color: #666; font-size: 0.9rem;">é»˜è®¤ï¼šadmin@gametopup.com / admin123</p>
    </div>
  </div>

  <!-- ç®¡ç†é¢æ¿ -->
  <div class="admin-layout" id="adminPanel" style="display: none;">
    <!-- ä¾§è¾¹æ  -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <h2>ğŸ® GameTopUp</h2>
        <p>ç®¡ç†åå°</p>
      </div>
      <div class="sidebar-menu">
        <div class="menu-item active" onclick="switchTab('dashboard')">
          <i class="fas fa-home"></i>
          <span class="menu-text">ä»ªè¡¨ç›˜</span>
        </div>
        <div class="menu-item" onclick="switchTab('games')">
          <i class="fas fa-gamepad"></i>
          <span class="menu-text">æ¸¸æˆç®¡ç†</span>
        </div>
        <div class="menu-item" onclick="switchTab('orders')">
          <i class="fas fa-shopping-cart"></i>
          <span class="menu-text">è®¢å•ç®¡ç†</span>
        </div>
        <div class="menu-item" onclick="switchTab('seo')">
          <i class="fas fa-search"></i>
          <span class="menu-text">SEO ç®¡ç†</span>
        </div>
        <div class="menu-item" onclick="switchTab('users')">
          <i class="fas fa-users"></i>
          <span class="menu-text">ç”¨æˆ·ç®¡ç†</span>
        </div>
      </div>
    </aside>

    <!-- ä¸»å†…å®¹åŒº -->
    <main class="main-content">
      <!-- é¡¶éƒ¨æ  -->
      <div class="top-bar">
        <h1 id="pageTitle">ä»ªè¡¨ç›˜</h1>
        <div class="user-info">
          <span id="adminName">ç®¡ç†å‘˜</span>
          <div class="logout-btn" onclick="logout()">é€€å‡º</div>
        </div>
      </div>

      <!-- ä»ªè¡¨ç›˜ -->
      <div class="tab-content active" id="tabDashboard">
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon games"><i class="fas fa-gamepad"></i></div>
            <div class="stat-info">
              <h3 id="statGames">0</h3>
              <p>æ€»æ¸¸æˆæ•°</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon orders"><i class="fas fa-shopping-cart"></i></div>
            <div class="stat-info">
              <h3 id="statOrders">0</h3>
              <p>æ€»è®¢å•æ•°</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon seo"><i class="fas fa-search"></i></div>
            <div class="stat-info">
              <h3 id="statSEO">0</h3>
              <p>SEO é¡µé¢æ•°</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon users"><i class="fas fa-users"></i></div>
            <div class="stat-info">
              <h3 id="statUsers">0</h3>
              <p>æ€»ç”¨æˆ·æ•°</p>
            </div>
          </div>
        </div>

        <div class="content-section">
          <h2 style="margin-bottom: 20px;">æœ€è¿‘è®¢å•</h2>
          <table class="data-table">
            <thead>
              <tr><th>è®¢å•å·</th><th>æ¸¸æˆ</th><th>é‡‘é¢</th><th>çŠ¶æ€</th><th>æ—¶é—´</th></tr>
            </thead>
            <tbody id="recentOrders"></tbody>
          </table>
        </div>
      </div>

      <!-- æ¸¸æˆç®¡ç† -->
      <div class="tab-content" id="tabGames">
        <div class="content-section">
          <div class="section-header">
            <h2 class="section-title">æ¸¸æˆåˆ—è¡¨</h2>
            <button class="btn btn-add" onclick="addGame()">+ æ·»åŠ æ¸¸æˆ</button>
          </div>
          <div class="search-box">
            <input type="text" class="search-input" id="gameSearch" placeholder="æœç´¢æ¸¸æˆ..." oninput="filterGames()">
          </div>
          <table class="data-table">
            <thead>
              <tr><th>ID</th><th>æ¸¸æˆåç§°</th><th>ä»·æ ¼</th><th>çŠ¶æ€</th><th>æ“ä½œ</th></tr>
            </thead>
            <tbody id="gamesTable"></tbody>
          </table>
          <div class="pagination">
            <div class="pagination-info">æ˜¾ç¤º <span id="gameStart">1</span>-<span id="gameEnd">10</span> å…± <span id="gameTotal">0</span> æ¡</div>
            <div class="pagination-buttons" id="gamePagination"></div>
          </div>
        </div>
      </div>

      <!-- è®¢å•ç®¡ç† -->
      <div class="tab-content" id="tabOrders">
        <div class="content-section">
          <div class="section-header">
            <h2 class="section-title">è®¢å•åˆ—è¡¨</h2>
          </div>
          <div class="search-box">
            <input type="text" class="search-input" id="orderSearch" placeholder="æœç´¢è®¢å•å·æˆ–æ¸¸æˆ..." oninput="filterOrders()">
            <select class="search-input" style="width: 200px;" id="orderStatusFilter" onchange="filterOrders()">
              <option value="">å…¨éƒ¨çŠ¶æ€</option>
              <option value="pending">å¾…æ”¯ä»˜</option>
              <option value="completed">å·²å®Œæˆ</option>
              <option value="cancelled">å·²å–æ¶ˆ</option>
            </select>
          </div>
          <table class="data-table">
            <thead>
              <tr><th>è®¢å•å·</th><th>æ¸¸æˆ</th><th>é‡‘é¢</th><th>çŠ¶æ€</th><th>æ—¶é—´</th><th>æ“ä½œ</th></tr>
            </thead>
            <tbody id="ordersTable"></tbody>
          </table>
          <div class="pagination">
            <div class="pagination-info">æ˜¾ç¤º <span id="orderStart">1</span>-<span id="orderEnd">10</span> å…± <span id="orderTotal">0</span> æ¡</div>
            <div class="pagination-buttons" id="orderPagination"></div>
          </div>
        </div>
      </div>

      <!-- SEO ç®¡ç† -->
      <div class="tab-content" id="tabSEO">
        <div class="content-section">
          <div class="section-header">
            <h2 class="section-title">SEO ç®¡ç†</h2>
          </div>
          <table class="data-table">
            <thead>
              <tr><th>é¡µé¢è·¯å¾„</th><th>æ ‡é¢˜</th><th>æè¿°</th><th>çŠ¶æ€</th><th>æ“ä½œ</th></tr>
            </thead>
            <tbody id="seoTable"></tbody>
          </table>
        </div>
      </div>

      <!-- ç”¨æˆ·ç®¡ç† -->
      <div class="tab-content" id="tabUsers">
        <div class="content-section">
          <div class="section-header">
            <h2 class="section-title">ç”¨æˆ·åˆ—è¡¨</h2>
          </div>
          <table class="data-table">
            <thead>
              <tr><th>ç”¨æˆ· ID</th><th>é‚®ç®±</th><th>è§’è‰²</th><th>æ³¨å†Œæ—¶é—´</th><th>æ“ä½œ</th></tr>
            </thead>
            <tbody id="usersTable"></tbody>
          </table>
        </div>
      </div>
    </main>
  </div>

  <script>
    let authToken = null;
    let currentData = { games: [], orders: [], seo: [], users: [] };
    let currentPage = { games: 1, orders: 1 };
    const itemsPerPage = 10;

    // ç™»å½•
    async function login() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      
      const { data, error } = await db.auth.signInWithPassword({ email, password });
      if (error) { alert('ç™»å½•å¤±è´¥ï¼š' + error.message); return; }
      
      const { data: profile } = await db.from('profiles').select('role').eq('id', data.user.id).single();
      if (profile?.role !== 'admin') { alert('æ— æƒè®¿é—®åå°'); await db.auth.signOut(); return; }
      
      // ğŸ”§ ä¿å­˜ç™»å½•çŠ¶æ€åˆ° localStorage
      authToken = data.session.access_token;
      localStorage.setItem('adminToken', authToken);
      localStorage.setItem('adminEmail', email);
      
      document.getElementById('adminName').textContent = email.split('@')[0];
      document.getElementById('loginContainer').style.display = 'none';
      document.getElementById('adminPanel').style.display = 'flex';
      loadAllData();
    }

    // é€€å‡ºç™»å½•
    function logout() {
      localStorage.removeItem('adminToken');
      localStorage.removeItem('adminEmail');
      location.reload();
    }

    // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥ç™»å½•çŠ¶æ€
    window.addEventListener('load', async () => {
      const savedToken = localStorage.getItem('adminToken');
      const savedEmail = localStorage.getItem('adminEmail');
      
      if (savedToken && savedEmail) {
        const { data: { session } } = await db.auth.getSession();
        if (session && session.access_token === savedToken) {
          authToken = savedToken;
          document.getElementById('email').value = savedEmail;
          document.getElementById('adminName').textContent = savedEmail.split('@')[0];
          document.getElementById('loginContainer').style.display = 'none';
          document.getElementById('adminPanel').style.display = 'flex';
          loadAllData();
        } else {
          localStorage.removeItem('adminToken');
          localStorage.removeItem('adminEmail');
        }
      }
    });

// ğŸ”§ ä¿®å¤ç‰ˆ switchTab å‡½æ•°
function switchTab(tabName) {
  // æ›´æ–°ä¾§è¾¹æ é€‰ä¸­çŠ¶æ€
  document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('active'));
  // æ‰¾åˆ°è¢«ç‚¹å‡»çš„ menu-item å¹¶æ·»åŠ  active
  const clickedItem = event.target.closest('.menu-item');
  if (clickedItem) {
    clickedItem.classList.add('active');
  }
  
  // éšè—æ‰€æœ‰å†…å®¹
  document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
  
  // ğŸ”§ æ­£ç¡®çš„ ID æ˜ å°„ï¼ˆç¡®ä¿å’Œ HTML ä¸­çš„ id ä¸€è‡´ï¼‰
  const tabIdMap = {
    'dashboard': 'tabDashboard',
    'games': 'tabGames',
    'orders': 'tabOrders',
    'seo': 'tabSEO',
    'users': 'tabUsers'
  };
  
  const targetId = tabIdMap[tabName];
  const targetTab = document.getElementById(targetId);
  
  if (targetTab) {
    targetTab.classList.add('active');
    
    // æ›´æ–°é¡µé¢æ ‡é¢˜
    const titles = {
      'dashboard': 'ä»ªè¡¨ç›˜',
      'games': 'æ¸¸æˆç®¡ç†',
      'orders': 'è®¢å•ç®¡ç†',
      'seo': 'SEO ç®¡ç†',
      'users': 'ç”¨æˆ·ç®¡ç†'
    };
    const titleEl = document.getElementById('pageTitle');
    if (titleEl) titleEl.textContent = titles[tabName] || tabName;
    
    console.log(`âœ… åˆ‡æ¢åˆ°: ${tabName}`);
  } else {
    console.error(`âŒ æœªæ‰¾åˆ°æ ‡ç­¾é¡µ: ${targetId}`);
    console.log('å¯ç”¨çš„ tabIdMap:', tabIdMap);
  }
}
    async function loadAllData() {
      await loadGames();
      await loadOrders();
      await loadSEO();
      await loadUsers();
      updateStats();
      loadRecentOrders();
    }

    // åŠ è½½æ¸¸æˆï¼ˆå¸¦åˆ†é¡µï¼‰
    async function loadGames() {
      const { data } = await db.from('games').select('*');
      currentData.games = data || [];
      renderGamesTable();
    }

    function renderGamesTable() {
      const page = currentPage.games;
      const start = (page - 1) * itemsPerPage;
      const end = start + itemsPerPage;
      const games = currentData.games.slice(start, end);
      
      document.getElementById('gamesTable').innerHTML = games.map(g => `
        <tr>
          <td>${g.id}</td>
          <td>${g.name}</td>
          <td>Â¥${g.price}</td>
          <td><span class="badge badge-${g.active ? 'success' : 'danger'}">${g.active ? 'å¯ç”¨' : 'ç¦ç”¨'}</span></td>
          <td>
            <div class="btn-group">
              <button class="btn btn-sm btn-edit" onclick="editGame('${g.id}')">ç¼–è¾‘</button>
              <button class="btn btn-sm btn-delete" onclick="deleteGame('${g.id}')">åˆ é™¤</button>
            </div>
          </td>
        </tr>
      `).join('');
      
      updatePagination('game', currentData.games.length);
    }

    // åŠ è½½è®¢å•ï¼ˆå¸¦åˆ†é¡µå’Œç­›é€‰ï¼‰
    async function loadOrders() {
      const { data } = await db.from('orders').select('*').order('created_at', { ascending: false });
      currentData.orders = data || [];
      renderOrdersTable();
    }

    function renderOrdersTable() {
      let orders = currentData.orders;
      
      // åº”ç”¨ç­›é€‰
      const search = document.getElementById('orderSearch')?.value.toLowerCase() || '';
      const statusFilter = document.getElementById('orderStatusFilter')?.value || '';
      
      if (search) {
        orders = orders.filter(o => o.id.toLowerCase().includes(search) || (o.game_id && o.game_id.toLowerCase().includes(search)));
      }
      if (statusFilter) {
        orders = orders.filter(o => o.status === statusFilter);
      }
      
      const page = currentPage.orders;
      const start = (page - 1) * itemsPerPage;
      const end = start + itemsPerPage;
      const paginatedOrders = orders.slice(start, end);
      
      document.getElementById('ordersTable').innerHTML = paginatedOrders.map(o => `
        <tr>
          <td>${o.id}</td>
          <td>${o.game_id || '-'}</td>
          <td>Â¥${o.total?.toFixed(2) || '0.00'}</td>
          <td><span class="badge badge-${o.status === 'completed' ? 'success' : o.status === 'pending' ? 'warning' : 'danger'}">${o.status}</span></td>
          <td>${new Date(o.created_at).toLocaleString()}</td>
          <td>
            <div class="btn-group">
              <button class="btn btn-sm btn-edit" onclick="completeOrder('${o.id}')">å®Œæˆ</button>
              <button class="btn btn-sm btn-delete" onclick="cancelOrder('${o.id}')">å–æ¶ˆ</button>
            </div>
          </td>
        </tr>
      `).join('');
      
      updatePagination('order', orders.length);
    }

    // åŠ è½½ SEO
    async function loadSEO() {
      const { data } = await db.from('seo_meta').select('*').order('page_path');
      currentData.seo = data || [];
      renderSEOTable();
    }

    function renderSEOTable() {
      document.getElementById('seoTable').innerHTML = currentData.seo.map(s => `
        <tr>
          <td><code>${s.page_path}</code></td>
          <td>${s.title}</td>
          <td>${s.description ? s.description.substring(0, 50) + '...' : '-'}</td>
          <td><span class="badge badge-${s.active ? 'success' : 'danger'}">${s.active ? 'å¯ç”¨' : 'ç¦ç”¨'}</span></td>
          <td><button class="btn btn-sm btn-edit" onclick="editSEO('${s.page_path}')">ç¼–è¾‘</button></td>
        </tr>
      `).join('');
    }

    // åŠ è½½ç”¨æˆ·
    async function loadUsers() {
      const { data } = await db.from('profiles').select('*');
      currentData.users = data || [];
      renderUsersTable();
    }

    function renderUsersTable() {
      document.getElementById('usersTable').innerHTML = currentData.users.map(u => `
        <tr>
          <td>${u.id}</td>
          <td>${u.email}</td>
          <td><span class="badge badge-${u.role === 'admin' ? 'success' : 'warning'}">${u.role}</span></td>
          <td>${new Date(u.created_at).toLocaleString()}</td>
          <td><button class="btn btn-sm btn-edit">ç¼–è¾‘</button></td>
        </tr>
      `).join('');
    }

    // æ›´æ–°ç»Ÿè®¡
    function updateStats() {
      document.getElementById('statGames').textContent = currentData.games.length;
      document.getElementById('statOrders').textContent = currentData.orders.length;
      document.getElementById('statSEO').textContent = currentData.seo.length;
      document.getElementById('statUsers').textContent = currentData.users.length;
    }

    // åŠ è½½æœ€è¿‘è®¢å•
    function loadRecentOrders() {
      const recent = currentData.orders.slice(0, 5);
      document.getElementById('recentOrders').innerHTML = recent.map(o => `
        <tr>
          <td>${o.id}</td>
          <td>${o.game_id || '-'}</td>
          <td>Â¥${o.total?.toFixed(2) || '0.00'}</td>
          <td><span class="badge badge-${o.status === 'completed' ? 'success' : 'warning'}">${o.status}</span></td>
          <td>${new Date(o.created_at).toLocaleString()}</td>
        </tr>
      `).join('');
    }

    // åˆ†é¡µåŠŸèƒ½
    function updatePagination(type, total) {
      const totalPages = Math.ceil(total / itemsPerPage);
      const page = currentPage[type];
      
      document.getElementById(`${type}Start`).textContent = total === 0 ? 0 : (page - 1) * itemsPerPage + 1;
      document.getElementById(`${type}End`).textContent = Math.min(page * itemsPerPage, total);
      document.getElementById(`${type}Total`).textContent = total;
      
      let html = '';
      html += `<button class="page-btn" onclick="changePage('${type}', ${page - 1})" ${page === 1 ? 'disabled' : ''}>ä¸Šä¸€é¡µ</button>`;
      
      for (let i = 1; i <= totalPages; i++) {
        if (i === 1 || i === totalPages || (i >= page - 1 && i <= page + 1)) {
          html += `<button class="page-btn ${i === page ? 'active' : ''}" onclick="changePage('${type}', ${i})">${i}</button>`;
        } else if (i === page - 2 || i === page + 2) {
          html += `<span style="padding: 0 10px;">...</span>`;
        }
      }
      
      html += `<button class="page-btn" onclick="changePage('${type}', ${page + 1})" ${page === totalPages || totalPages === 0 ? 'disabled' : ''}>ä¸‹ä¸€é¡µ</button>`;
      
      document.getElementById(`${type}Pagination`).innerHTML = html;
    }

    function changePage(type, page) {
      currentPage[type] = page;
      if (type === 'game') renderGamesTable();
      else if (type === 'order') renderOrdersTable();
    }

    function filterGames() {
      renderGamesTable();
    }

    function filterOrders() {
      currentPage.orders = 1;
      renderOrdersTable();
    }

    // æ“ä½œå‡½æ•°
    window.addGame = function() {
      const id = prompt('æ¸¸æˆ ID:');
      const name = prompt('æ¸¸æˆåç§°:');
      const price = prompt('èµ·å§‹ä»·æ ¼:');
      if (id && name && price) {
        db.from('games').insert([{ id, name, price: parseFloat(price), active: true }]);
        loadGames();
        updateStats();
      }
    };

    window.editGame = async function(id) {
      const game = currentData.games.find(g => g.id === id);
      if (!game) return;
      const seoTitle = prompt('SEO æ ‡é¢˜:', game.seo_title || '');
      const seoDesc = prompt('SEO æè¿°:', game.seo_description || '');
      if (seoTitle !== null) {
        await db.from('games').update({ seo_title: seoTitle, seo_description: seoDesc }).eq('id', id);
        loadGames();
      }
    };

    window.deleteGame = async function(id) {
      if (!confirm('ç¡®å®šåˆ é™¤ï¼Ÿ')) return;
      await db.from('games').delete().eq('id', id);
      loadGames();
      updateStats();
    };

    window.completeOrder = async function(id) {
      await db.from('orders').update({ status: 'completed', paid_at: new Date().toISOString() }).eq('id', id);
      loadOrders();
      updateStats();
    };

    window.cancelOrder = async function(id) {
      if (!confirm('ç¡®å®šå–æ¶ˆï¼Ÿ')) return;
      await db.from('orders').update({ status: 'cancelled' }).eq('id', id);
      loadOrders();
      updateStats();
    };

    window.editSEO = function(pagePath) {
      alert('SEO ç¼–è¾‘åŠŸèƒ½å¼€å‘ä¸­...');
    };
  </script>
</body>
</html>